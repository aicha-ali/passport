# Passport-jwt-mysql 🔒

This app allows users to register and authenticate themselves with rapidity and security.


## SUMMARY

### [Project initiation](#a-simple-preview) 🏁
- How to lunch the project.
#### [Prerequisites](#a-simple-preview) ☝️
- What you don't want to forget

### [Let's understand our dependencies](#a-simple-preview) 🤔
- Descriptions of our dependencies.

### [How it works ?](#how-it-works--%F0%9F%92%BB)
#### [A simple preview](#a-simple-preview)
- The code's logic.
#### [Demo!](#demo-%F0%9F%94%A5) 🔥
- Some demo from our application features

## 🏁 Project initiation 🏁
 - git clone https://github.com/qdanneville/passport-jwt-mysql
 (allows to get this remote project locally)
- npm install
(install all the dependencies nested on the package.json)

- npm run start-dev
(launch your project locally)

### Prerequisites ☝️

 - Don't forget to import passport-auth.sql on your database (on pspmyadmin for exemple)
 - Change var connection on "db.js" according to you configuration (don't forget the socket path fo mac users)
 -  ⚠️ Launch [xampp/mampp/lampp]( https://www.apachefriends.org/fr/index.html) before "npm run start-dev"
 - Install [Postman](https://www.getpostman.com/) to do call api without front

## Let's understand our dependencies 🤔

- [passport](http://www.passportjs.org/) : authentification middleware for node.js
- [jwt](https://www.npmjs.com/package/jsonwebtoken)  : generate decode and validate tokens
- [mysql](https://www.npmjs.com/package/mysql) : driver for utilisation of mysql (duh)
- [bcrypt](https://www.npmjs.com/package/bcrypt) : a password hashing function
- [express](https://www.npmjs.com/package/express) : thin layer of fundamental web application feature
- [morgan](https://www.npmjs.com/package/morgan) : a logger for middlewares
- [cors](https://www.npmjs.com/package/cors) : allows AJAX requests to skip the Same-origin policy - and access resources from remote hosts


## How it works ? 💻

### A simple preview
- We start from the server.js file to 
configure our server.
- Then to users.controller.js wich define the method (in our case two post). 
- Then to users.service.js to define the function use with the diferents methods : 

 📄 Register function : who alows user to register themself to the db.

 🔑 Authenticate function : who alows user who are already register to authenticate themself

 ### Demo ! 🔥

#### Register 📄 

We submit an email and a password to register our user on Postman (http://localhost:5000/api/users/register) according to routers on "users.controller.js" file : 


 ![alt text](https://media.discordapp.net/attachments/465454750750474251/577793322727374848/Register1.png)

 If there's an email and a password, it's a success

 ![alt text](https://media.discordapp.net/attachments/465454750750474251/577793362808143874/Register2.png)

### ⚠️ WARNING
![alt text](https://media.discordapp.net/attachments/465454750750474251/577798234483982341/error1.png)

If you missed one of those two informations you gonna have some problems :
![alt text](https://media.discordapp.net/attachments/465454750750474251/577798233540263937/error.png?width=800&height=269)

In the function who manage the authentification and the registration (register and authenticate) we need both mail and password.


 💡 To sum up, when we submit to register : 
 - We call routers and methods on "users.controller.js"
 - then, register function on "users.service.js"
 - then db.createUser function on "db.js" wich calls the hash function (so generate it) and make the sql request

#### Authenticate 🔑 
We submit an email and a password wich already exists to authenticate our user on Postman (http://localhost:5000/api/users/authenticate) according to routers on "users.controller.js" file

![alt text](https://media.discordapp.net/attachments/465454750750474251/577793968553721866/authenticate2.png)

If the user already exists, he's authenticated and he gets a token generated by anthenticate function  on "users.service.js" 
![alt text](https://media.discordapp.net/attachments/465454750750474251/577793965676429317/authenticate1.png?width=800&height=71)

 💡 To sum up, when we submit to authenticate : 
 - We call routers and methods on "users.controller.js"
 - then, call register function on "users.service.js" wich authenticate user with db.findUser (sql request on "db.js"), compare hash already generated (crypt.compareHash function in "crypt.js") and generate token with jwt
 


# Thank you !
[Olivia Zeboudj](https://github.com/OliOliv) & [Aicha Ali](https://github.com/aicha-ali)